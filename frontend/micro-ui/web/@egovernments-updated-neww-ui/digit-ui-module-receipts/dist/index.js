var e,t=require("react"),n=(e=t)&&"object"==typeof e&&"default"in e?e.default:e,a=require("react-router-dom"),l=require("@egovernments/digit-ui-react-components"),i=require("react-i18next"),r=require("react-hook-form");function o(){return(o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function s(e,t){if(null==e)return{};var n,a,l={},i=Object.keys(e);for(a=0;a<i.length;a++)t.indexOf(n=i[a])>=0||(l[n]=e[n]);return l}var c=["isLoading","isError","errors","data"],u=function(e){var i,r,u=e.t,d=e.closeModal,m=e.applicationData,E=a.useHistory(),v=t.useState({}),p=v[0],C=v[1],S=t.useState([]),g=S[0],f=S[1],R=t.useState(""),_=R[0],P=R[1],N=(Digit.ULBService.getCurrentTenantId(),Digit.ULBService.getStateId()),h=Digit.Hooks.receipts.useReceiptsMDMS(N,"CancelReceiptReason"),L=h.isLoading,b=h.data;s(h,c),t.useEffect(function(){return C(function(e){var t=e.t,a=e.selectedReason,i=e.Reasons,r=e.selectReason;return{label:{heading:"CR_COMMON_HEADER",submit:"CR_CANCEL_RECEIPT_BUTTON"},form:[{body:[{label:t("CR_RECEIPT_CANCELLATION_REASON_LABEL"),type:"dropdown",isMandatory:!0,name:"reason",populators:n.createElement(l.Dropdown,{isMandatory:!0,selected:a,optionKey:"name",option:i,select:r,t:t})},{label:t("CR_MORE_DETAILS_LABEL"),type:"text",populators:{name:"otherDetails"},disable:"OTHER"!=(null==a?void 0:a.code)},{label:t("CR_ADDITIONAL_PENALTY"),type:"text",populators:{name:"penalty",disable:!0},disable:!0}]}]}}({t:u,selectedReason:_,Reasons:g,selectReason:A}))},[g,_]);var T=function(e){return n.createElement("h1",{className:"heading-m"},e.label)};function A(e){P(e)}var y=function(){return n.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"#FFFFFF"},n.createElement("path",{d:"M0 0h24v24H0V0z",fill:"none"}),n.createElement("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"}))},I=function(e){return n.createElement("div",{className:"icon-bg-secondary",onClick:e.onClick},n.createElement(y,null))};return t.useEffect(function(){f(null==b?void 0:b.dropdownData)},[b]),L?n.createElement(l.Loader,null):null!=p&&p.form?n.createElement(l.Modal,{headerBarMain:n.createElement(T,{label:u(null==p||null===(i=p.label)||void 0===i?void 0:i.heading)}),headerBarEnd:n.createElement(I,{onClick:d}),actionCancelOnSubmit:d,actionSaveLabel:u(null==p||null===(r=p.label)||void 0===r?void 0:r.submit),actionSaveOnSubmit:function(){},formId:"modal-action",isDisabled:!_},n.createElement(l.FormComposer,{config:null==p?void 0:p.form,noBoxShadow:!0,inline:!0,disabled:!0,childrenAtTheBottom:!0,onSubmit:function(e){var t,n,a,l;E.replace("/digit-ui/employee/receipts/response",{paymentWorkflow:{action:"CANCEL",additionalDetails:o({},e.otherDetails,{selectedReasonMessage:u("CR_REASON_"+_.code)}),paymentId:null==m||null===(t=m.Payments[0])||void 0===t?void 0:t.id,reason:_.code,tenantId:null==m||null===(n=m.Payments[0])||void 0===n?void 0:n.tenantId},key:"UPDATE",action:"CANCELLATION",businessService:null==m||null===(a=m.Payments[0])||void 0===a||null===(l=a.paymentDetails[0])||void 0===l?void 0:l.businessService})},formId:"modal-action"})):n.createElement(l.Loader,null)},d=function(e){return n.createElement(u,e)},m=function(e){if(e){var t=new Date(e),n=t.getMonth()+1,a=t.getDate();return(a=(a>9?"":"0")+a)+"/"+(n=(n>9?"":"0")+n)+"/"+t.getFullYear()}return"NA"},E=function(e,t){void 0===e&&(e=""),void 0===t&&(t="");var n=function(e){return void 0===e&&(e=""),function(e){return void 0===e&&(e=""),!(!e||null==e||null==e||""==e)}(e)&&(e.replaceAll&&e.replaceAll(".","_")||e.replace&&function(e,t,n){if(void 0===e&&(e=""),void 0===t&&(t=""),void 0===n&&(n=""),""==t)return e;for(;e.includes(t);)e=e.replace(t,n);return e}(e,".","_"))||"NA"}(e);return"NA"==n?"PT_NA":t+"_"+n},v=["searchParams","onFilterChange","onSearch","removeParam"],p=["data","isLoading"],C=function(e){var a=e.searchParams,r=e.onFilterChange,o=s(e,v),c=(Digit.ULBService.getCurrentTenantId(),Digit.ULBService.getStateId()),u=t.useState(function(){return a}),d=u[0],m=u[1],E=i.useTranslation().t,C=t.useState([]),S=C[0],g=C[1],f=t.useState({name:"BILLINGSERVICE_BUSINESSSERVICE_PT",code:"PT"}),R=f[0],_=f[1],P=Digit.Hooks.receipts.useReceiptsMDMS(c,"CancelReceiptReasonAndStatus"),N=P.data,h=P.isLoading,L=(s(P,p),(null==N?void 0:N.dropdownDataStatus)||[]);t.useEffect(function(){(null==R?void 0:R.code)!=d.businessServices&&m({businessServices:null==R?void 0:R.code})},[R]),t.useEffect(function(){S&&m({status:S.join(",")})},[S]);var b=function(){var e;r({delete:Object.keys(a)},!0),g([]),_({name:"BILLINGSERVICE_BUSINESSSERVICE_PT",code:"PT"}),null==o||null===(e=o.onClose)||void 0===e||e.call(o)};return h?n.createElement(l.Loader,null):n.createElement(n.Fragment,null,n.createElement("div",{className:"filter"},n.createElement("div",{className:"filter-card"},n.createElement("div",{className:"heading"},n.createElement("div",{className:"filter-label"},E("COMMON_TABLE_FILTERS"),":"),n.createElement("div",{className:"clearAll",onClick:b},E("CR_COMMON_CLEAR_ALL")),"desktop"===o.type&&n.createElement("span",{className:"clear-search",onClick:b,style:{border:"1px solid #e0e0e0",padding:"6px"}},n.createElement("svg",{width:"17",height:"17",viewBox:"0 0 16 22",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M8 5V8L12 4L8 0V3C3.58 3 0 6.58 0 11C0 12.57 0.46 14.03 1.24 15.26L2.7 13.8C2.25 12.97 2 12.01 2 11C2 7.69 4.69 5 8 5ZM14.76 6.74L13.3 8.2C13.74 9.04 14 9.99 14 11C14 14.31 11.31 17 8 17V14L4 18L8 22V19C12.42 19 16 15.42 16 11C16 9.43 15.54 7.97 14.76 6.74Z",fill:"#505A5F"}))),"mobile"===o.type&&n.createElement("span",{onClick:o.onClose},n.createElement(l.CloseSvg,null))),n.createElement("div",null,n.createElement("div",null,n.createElement("div",{className:"filter-label"},E("CR_COMMON_TABLE_COL_STATUS")),L.map(function(e,t){return n.createElement(l.CheckBox,{key:t+"service",label:E(null==e?void 0:e.name),value:null==e?void 0:e.code,checked:S.includes(null==e?void 0:e.code),onChange:function(e){return S.includes(t=e.target.value)?S.splice(S.findIndex(function(e){return e==t}),1):S.push(t),void g([].concat(S));var t}})}),n.createElement("div",null,n.createElement("div",{className:"filter-label"},E("CR_SERVICE_CATEGORY_LABEL")),n.createElement(l.Dropdown,{t:E,option:(null==N?void 0:N.dropdownData)||null,value:R,selected:R,select:_,optionKey:"name"})),"mobile"!==o.type&&n.createElement("div",null,n.createElement(l.SubmitBar,{onSubmit:function(){var e;r(d),null==o||null===(e=o.onClose)||void 0===e||e.call(o)},label:E("ACTION_TEST_APPLY")})),"mobile"===o.type&&n.createElement(l.ActionBar,null,n.createElement(l.ApplyFilterBar,{submit:!1,labelLink:E("ES_COMMON_CLEAR_ALL"),buttonLink:E("ACTION_TEST_APPLY"),onSubmit:function(){var e;r(d),null==o||null===(e=o.onClose)||void 0===e||e.call(o)},onClear:function(){var e;b(),null==o||null===(e=o.onClose)||void 0===e||e.call(o)},style:{flex:1}})))))))},S=function(e){var t=e.path,r=i.useTranslation().t,s=(a.useLocation(),innerWidth<=640),c={searchParams:{tenantId:Digit.ULBService.getCurrentTenantId(),businessServices:"PT"}},u=Digit.ComponentRegistryService.getComponent("ReceiptInbox"),d=Digit.ComponentRegistryService.getComponent("ReceiptAcknowledgement"),m=Digit.ComponentRegistryService.getComponent("ReceiptDetails");return n.createElement(a.Switch,null,n.createElement(n.Fragment,null,n.createElement("div",{className:"ground-container"},n.createElement("p",{className:"breadcrumb",style:{marginLeft:s?"2vw":"revert"}},n.createElement(a.Link,{to:"/digit-ui/employee",style:{cursor:"pointer",color:"#666"}},r("ES_COMMON_HOME"))," ","/ ",n.createElement("span",null,r("CR_COMMON_HEADER"))),n.createElement(l.PrivateRoute,{path:t+"/inbox",component:function(){return n.createElement(u,{parentRoute:t,businessService:"receipts",filterComponent:"RECEIPTS_INBOX_FILTER",initialStates:c,isInbox:!0})}}),n.createElement(l.PrivateRoute,{path:t+"/inprogress",component:function(e){return n.createElement("h2",null,r("CR_RECEIPTS_SCREENS_UNDER_CONSTRUCTION"))}}),n.createElement(l.PrivateRoute,{path:t+"/response",component:function(e){return n.createElement(d,o({},e,{parentRoute:t}))}}),n.createElement(l.PrivateRoute,{path:t+"/details/:service/:id",component:function(){return n.createElement(m,null)}}))))},g=function(e){var t,a,i,r,o;return n.createElement(l.Banner,{message:(r=e.isSuccess,o=e.t,function(e,t,n,a,l){return l("CR_APPLY_"+(n?"SUCCESS":"FAILURE")+"_MESSAGE_MAIN")}(0,0,r,0,o)),applicationNumber:null==e||null===(t=e.data)||void 0===t||null===(a=t.Payments)||void 0===a||null===(i=a[0])||void 0===i?void 0:i.paymentDetails[0].receiptNumber,info:e.isSuccess?e.t("CR_RECEIPT_NUMBER"):"",successful:e.isSuccess})},f=["isLoading","isError","error","data"],R=function(e){var r=e.businessService,o=e.allLinks,s=e.headerText,c=i.useTranslation().t,u=t.useState([]),d=u[0],m=u[1],E=Digit.UserService.getUser().info.roles;return t.useEffect(function(){var e=o.filter(function(e){return e.businessService===r}).filter(function(e){var t=e.roles;return t.some(function(e){return E.map(function(e){return e.code}).includes(e)})||!t.length});m(e)},[]),n.createElement(l.Card,{className:"employeeCard filter inboxLinks"},n.createElement("div",{className:"complaint-links-container"},n.createElement("div",{className:"header"},n.createElement("span",{className:"logo"},n.createElement(l.AnnouncementIcon,null))," ",n.createElement("span",{className:"text"},c(s))),n.createElement("div",{className:"body"},d.map(function(e,t){var l=e.link,i=e.text,r=e.hyperlink;return n.createElement("span",{className:"link",key:t},void 0!==r&&r?n.createElement("a",{href:l},c(i)):n.createElement(a.Link,{to:l},c(i)))}))))},_=function(e){return n.createElement(l.Table,{t:e.t,data:e.data,manualPagination:!0,columns:e.columns,getCellProps:e.getCellProps,onNextPage:e.onNextPage,onPrevPage:e.onPrevPage,currentPage:e.currentPage,totalRecords:e.totalRecords,onLastPage:e.onLastPage,onFirstPage:e.onFirstPage,onPageSizeChange:e.onPageSizeChange,pageSizeLimit:e.pageSizeLimit})},P=["pattern","name","maxLength","minLength","errorMessages"],N={date:l.DatePicker,mobileNumber:l.MobileNumber},h=function(e){var a,c,u=e.onSearch,d=e.type,m=e.onClose,E=e.searchFields,v=e.searchParams,p=e.isInboxPage,C=i.useTranslation().t,S=r.useForm({defaultValues:v}),g=S.register,f=S.handleSubmit,R=S.reset,_=S.watch,h=S.control,L=S.setError,b=S.clearErrors,T=S.formState,A=_(),y=innerWidth<=640;function I(){var e=E.reduce(function(e,t){var n;return o({},e,((n={})[null==t?void 0:t.name]="",n))},{});R(e);var t=o({},v);t.delete=[],E.forEach(function(e){t.delete.push(null==e?void 0:e.name)}),u(o({},t),!0),"mobile"===d&&m()}t.useEffect(function(){E.forEach(function(e){var t=e.pattern,n=e.name,a=e.maxLength,l=e.minLength,i=e.errorMessages,r=(s(e,P),A[n]),o=T.errors[n];t&&(new RegExp(t).test(r)||o?new RegExp(t).test(r)&&"pattern"===(null==o?void 0:o.type)&&b([n]):L(n,{type:"pattern",message:C(null==i?void 0:i.pattern)||C("PATTERN_"+n.toUpperCase()+"_FAILED")})),l&&((null==r?void 0:r.length)<l&&!o?L(n,{type:"minLength",message:C((null==i?void 0:i.minLength)||"MINLENGTH_"+n.toUpperCase()+"_FAILED")}):(null==r?void 0:r.length)>=l&&"minLength"===(null==o?void 0:o.type)&&b([n])),a&&((null==r?void 0:r.length)>a&&!o?L(n,{type:"maxLength",message:C((null==i?void 0:i.maxLength)||"MAXLENGTH_"+n.toUpperCase()+"_FAILED")}):(null==r?void 0:r.length)<=a&&"maxLength"===(null==o?void 0:o.type)&&b([n]))})},[A,T,L,b]);var O=function(e){return n.createElement(l.LinkLabel,{style:o({display:"inline"},e?{margin:0}:{}),onClick:I},C("CR_RESET_BUTTON"))};return n.createElement("form",{onSubmit:f(function(e){e.mobileNumber||delete e.mobileNumber,e.delete=[],E.forEach(function(t){e[t.name]||e.delete.push(t.name)}),u(e),"mobile"===d&&m()})},n.createElement(n.Fragment,null,n.createElement("div",{className:"search-container",style:{width:"auto",marginLeft:p?"24px":"revert"}},n.createElement("div",{className:"search-complaint-container"},("mobile"===d||y)&&n.createElement("div",{className:"complaint-header",style:{display:"flex",justifyContent:"space-between"}},n.createElement("h2",null,C("ES_COMMON_SEARCH_BY")),n.createElement("span",{onClick:m},n.createElement(l.CloseSvg,null))),n.createElement("div",{className:"complaint-input-container",style:{width:"100%"}},null==E||null===(a=E.filter(function(e){return!0}))||void 0===a?void 0:a.map(function(e,t){var a,i,s;return n.createElement("div",{key:e.name,className:"input-fields"},n.createElement("span",{className:"mobile-input"},n.createElement(l.Label,null,C(e.label)),n.createElement(r.Controller,e.type?{render:function(t){return n.createElement(null==N?void 0:N[e.type],{onChange:t.onChange,value:t.value})},name:e.name,control:h,defaultValue:""}:{render:function(t){return n.createElement("div",{className:"field-container"},null!=e&&e.componentInFront?n.createElement("span",{className:"employee-card-input employee-card-input--front",style:{flex:"none"}},null==e?void 0:e.componentInFront):null,n.createElement(l.TextInput,o({},e,{inputRef:g,watch:_,shouldUpdate:!0})))},name:e.name,control:h,defaultValue:""})),null!=T&&null!==(a=T.dirtyFields)&&void 0!==a&&a[e.name]?n.createElement("span",{style:{fontWeight:"700",color:"rgba(212, 53, 28)",paddingLeft:"8px",marginTop:"-20px",fontSize:"12px"},className:"inbox-search-form-error"},null==T||null===(i=T.errors)||void 0===i||null===(s=i[e.name])||void 0===s?void 0:s.message):null)}),"desktop"===d&&!y&&!p&&n.createElement("div",{className:"search-action-wrapper"},n.createElement(l.SubmitBar,{className:"submit-bar-search",label:C("CR_SEARCH_BUTTON"),submit:!0}),n.createElement("div",{style:(c={width:"100%",textAlign:"right"},c.width="240px",c.textAlign="right",c.marginLeft="96px",c.marginTop="8px",c)},O()))),p&&n.createElement("div",{className:"inbox-action-container"},"desktop"===d&&!y&&n.createElement("span",{style:{paddingTop:"9px"},className:"clear-search"},O()),"desktop"===d&&!y&&n.createElement(l.SubmitBar,{style:{marginTop:"unset"},className:"submit-bar-search",label:C("CR_SEARCH_BUTTON"),submit:!0})))),("mobile"===d||y)&&n.createElement(l.ActionBar,{className:"clear-search-container"},n.createElement("button",{className:"clear-search",style:{flex:1}},O(y)),n.createElement(l.SubmitBar,{label:C("CR_SEARCH_BUTTON"),style:{flex:1},submit:!0}))))},L=["tableConfig","filterComponent"],b=function(e){var r,o,c=e.filterComponent,u=s(e,L),d=i.useTranslation().t,m=Digit.SessionStorage.get("HRMS_TENANTS"),E=function(e){return n.createElement("span",{className:"cell-text"},d(e))},v=null==u||null===(r=u.data)||void 0===r?void 0:r.Payments,p=t.useState(function(){var e;return null===(e=Digit.ComponentRegistryService)||void 0===e?void 0:e.getComponent(c)})[0],C=n.useMemo(function(){return[{Header:d("CR_COMMON_TABLE_COL_RECEIPT_NO"),disableSortBy:!0,Cell:function(e){var t,l,i,r,o,s,c=e.row;return n.createElement("span",{className:"link"},n.createElement(a.Link,{to:"/digit-ui/employee/receipts/details/"+(null===(t=c.original)||void 0===t||null===(l=t.paymentDetails[0])||void 0===l?void 0:l.businessService)+"/"+encodeURIComponent(null===(i=c.original)||void 0===i||null===(r=i.paymentDetails[0])||void 0===r?void 0:r.receiptNumber)},null===(o=c.original)||void 0===o||null===(s=o.paymentDetails[0])||void 0===s?void 0:s.receiptNumber))}},{Header:d("CR_COMMON_TABLE_COL_DATE"),disableSortBy:!0,Cell:function(e){var t,a,l;return a=null===(t=e.row.original)||void 0===t?void 0:t.transactionDate,l=new Date(a),n.createElement("span",{className:"cell-text"},null==l?void 0:l.toLocaleDateString())}},{Header:d("CR_COMMON_TABLE_CONSUMERCODE"),disableSortBy:!0,Cell:function(e){var t,n,a;return E(""+(null===(t=e.row.original)||void 0===t||null===(n=t.paymentDetails[0])||void 0===n||null===(a=n.bill)||void 0===a?void 0:a.consumerCode))}},{Header:d("CR_COMMON_TABLE_COL_PAYEE_NAME"),disableSortBy:!0,Cell:function(e){var t;return E(""+(null===(t=e.row.original)||void 0===t?void 0:t.payerName))}},{Header:d("CR_SERVICE_TYPE_LABEL"),disableSortBy:!0,Cell:function(e){var t,n;return E(""+d("BILLINGSERVICE_BUSINESSSERVICE_"+(null===(t=e.row.original)||void 0===t||null===(n=t.paymentDetails[0])||void 0===n?void 0:n.businessService)))}},{Header:d("CR_COMMON_TABLE_COL_STATUS"),disableSortBy:!0,Cell:function(e){var t;return function(e,t,a){return void 0===a&&(a=""),n.createElement("span","CANCELLED"==e?{className:"sla-cell-error"}:{className:"sla-cell-success"},t(""+a+e)||"")}(""+(null===(t=e.row.original)||void 0===t?void 0:t.paymentStatus),d,"RC_")}}]},[]);if(u.isLoading)o=n.createElement(l.Loader,null);else if(0===(null==v?void 0:v.length))o=n.createElement(l.Card,{style:{marginTop:20}},d("CS_MYAPPLICATIONS_NO_APPLICATION").split("\\n").map(function(e,t){return n.createElement("p",{key:t,style:{textAlign:"center"}},e)}));else if((null==v?void 0:v.length)>0){var S;o=n.createElement(_,((S={t:d,data:v,columns:C,getCellProps:function(e){return{style:{maxWidth:e.column.Header===d("HR_EMP_ID_LABEL")?"140px":"",padding:"20px 18px",fontSize:"16px"}}},onPageSizeChange:u.onPageSizeChange,currentPage:u.currentPage,onNextPage:u.onNextPage,onPrevPage:u.onPrevPage,onLastPage:u.onLastPage,onFirstPage:u.onFirstPage,pageSizeLimit:u.pageSizeLimit,onSort:u.onSort,disableSort:u.disableSort}).onPageSizeChange=u.onPageSizeChange,S.sortParams=u.sortParams,S.totalRecords=u.totalRecords,S))}return n.createElement("div",{className:"inbox-container"},!u.isSearch&&n.createElement("div",{className:"filters-container"},n.createElement(R,{parentRoute:u.parentRoute,allLinks:[{text:"CR_COMMON_DASHBOARD_HEADER",link:"/digit-ui/employee/receipts/inprogress",businessService:"receipts",roles:["CR_PT"]},{text:"CR_COMMON_REPORTS_HEADER",link:"/digit-ui/employee/receipts/inprogress",businessService:"receipts",roles:["CR_PT"]}],headerText:d("ACTION_TEST_RECEIPTS"),businessService:u.businessService}),n.createElement("div",null,n.createElement(p,{defaultSearchParams:u.defaultSearchParams,onFilterChange:u.onFilterChange,searchParams:u.searchParams,type:"desktop",tenantIds:m}))),n.createElement("div",{style:{flex:1}},n.createElement(h,{defaultSearchParams:u.defaultSearchParams,onSearch:u.onSearch,type:"desktop",tenantIds:m,searchFields:u.searchFields,isInboxPage:!(null!=u&&u.isSearch),searchParams:u.searchParams}),n.createElement("div",{className:"result",style:{marginLeft:null!=u&&u.isSearch?"":"24px",flex:1}},o)))},T=function(e){var a=e.t,i=e.data,r=e.onFilterChange,o=e.onSearch,s=e.serviceRequestIdKey,c=e.isFstpOperator,u=e.isLoading,d=e.isSearch,m=e.searchParams,E=e.searchFields,v=e.sortParams,p=e.linkPrefix,S=e.defaultSearchParams,g=t.useState(d?"SEARCH":""),f=g[0],R=g[1],_=t.useState(!!d),P=_[0],N=_[1],L=t.useState(m)[1],b=t.useState(v)[1];t.useEffect(function(){f&&N(!0)},[f]);var T,A=Digit.UserService.hasAccess(["FSM_DSO"])||!1,y=function(){N(!1),R(""),L(m),b(v)};return u?n.createElement(l.Loader,null):(i&&0!==(null==i?void 0:i.length)?i&&(null==i?void 0:i.length)>0&&(T=n.createElement(l.DetailsCard,{data:i,serviceRequestIdKey:s,linkPrefix:p||(A?"/digit-ui/employee/fsm/application-details/":"/digit-ui/employee/fsm/")})):T=n.createElement(l.Card,{style:{marginTop:20}},a("CS_MYAPPLICATIONS_NO_APPLICATION").split("\\n").map(function(e,t){return n.createElement("p",{key:t,style:{textAlign:"center"}},e)})),n.createElement(n.Fragment,null,n.createElement("div",{className:"searchBox"},o&&n.createElement(l.SearchAction,{text:"SEARCH",handleActionClick:function(){R("SEARCH"),N(!0)}}),!d&&r&&n.createElement(l.FilterAction,{text:"FILTER",handleActionClick:function(){R("FILTER"),N(!0)}})),T,P&&n.createElement(l.PopUp,null,"FILTER"===f&&n.createElement("div",{className:"popup-module"},n.createElement(C,{defaultSearchParams:S,onFilterChange:r,searchParams:m,type:"mobile",onClose:y})),"SEARCH"===f&&n.createElement("div",{className:"popup-module"},n.createElement(h,{type:"mobile",onClose:y,onSearch:o,isFstpOperator:c,searchParams:m,searchFields:E})))))},A=function(e){return n.createElement("span",{className:"sla-cell"},e)},y=function(e){var t,a=e.data,l=e.isLoading,r=e.isSearch,o=e.searchFields,s=e.onFilterChange,c=e.onSearch,u=e.onSort,d=e.searchParams,m=e.sortParams,E=e.linkPrefix,v=e.filterComponent,p=e.defaultSearchParams,C=i.useTranslation().t;return n.createElement("div",{style:{padding:0}},n.createElement("div",{className:"inbox-container"},n.createElement("div",{className:"filters-container"},n.createElement(T,{t:C,data:null==a||null===(t=a.Payments)||void 0===t?void 0:t.map(function(e){var t,a,l,i,r,o;return(r={})[C("CR_COMMON_TABLE_COL_RECEIPT_NO")]=null==e||null===(t=e.paymentDetails[0])||void 0===t?void 0:t.receiptNumber,r[C("CR_COMMON_TABLE_COL_DATE")]=(o=new Date((null==e?void 0:e.transactionDate)||""),n.createElement("span",{className:"sla-cell"},null==o?void 0:o.toLocaleDateString())),r[C("CR_COMMON_TABLE_CONSUMERCODE")]=A((null==e||null===(a=e.paymentDetails[0])||void 0===a||null===(l=a.bill)||void 0===l?void 0:l.consumerCode)||""),r[C("CR_COMMON_TABLE_COL_PAYEE_NAME")]=A(null==e?void 0:e.payerName),r[C("CR_SERVICE_TYPE_LABEL")]=A(C("BILLINGSERVICE_BUSINESSSERVICE_"+(null==e||null===(i=e.paymentDetails[0])||void 0===i?void 0:i.businessService))),r[C("CR_COMMON_TABLE_COL_STATUS")]=A(C("RC_"+(null==e?void 0:e.paymentStatus))),r}),onFilterChange:s,isLoading:l,isSearch:r,onSearch:c,onSort:u,defaultSearchParams:p,searchParams:d,searchFields:o,linkPrefix:E,sortParams:m,filterComponent:v,serviceRequestIdKey:function(e){return(null==d?void 0:d.businessServices)+"/"+encodeURIComponent(null==e?void 0:e[C("CR_COMMON_TABLE_COL_RECEIPT_NO")])}}))))},I=["isLoading","data"],O=["isLoading","isError","error","data"],D=["isLoading","isError","error","data"],M=function(e){var t=e.stateCode,l=e.userType,i=Digit.StoreData.getCurrentLanguage(),r=(Digit.Services.useStore({stateCode:t,moduleCode:"RECEIPTS",language:i}),a.useRouteMatch());return"employee"===l?n.createElement(S,{path:r.path,url:r.url,userType:"employee"}):null},x={ReceiptsModule:M,ReceiptsCard:function(){if(!Digit.Utils.receiptsAccess())return null;var e=Digit.ULBService.getCurrentTenantId(),t=i.useTranslation().t,a=Digit.Hooks.receipts.useReceiptsSearch({tenantId:e,businessServices:"PT",isCountRequest:!0},e,[],!1),r=a.isLoading,o=a.data,c=(s(a,D),{Icon:n.createElement(l.ReceiptIcon,null),moduleName:t("ACTION_TEST_RECEIPTS"),kpis:[{count:r?"-":null==o?void 0:o.Count,label:t("CR_TOTAL_RECEIPTS"),link:"/digit-ui/employee/receipts/inbox"}],links:[{count:r?"-":null==o?void 0:o.Count,label:t("CR_SEARCH_COMMON_HEADER"),link:"/digit-ui/employee/receipts/inbox"}]});return n.createElement(l.EmployeeModuleCard,c)},ReceiptInbox:function(e){var a,r,c=e.parentRoute,u=e.businessService,d=void 0===u?"receipts":u,m=e.initialStates,E=void 0===m?{}:m,v=e.filterComponent,p=e.isInbox,C=Digit.ULBService.getCurrentTenantId(),S=Digit.SessionStorage.get("isupdate"),g=i.useTranslation().t,f=t.useState(E.pageOffset||0),R=f[0],_=f[1],P=t.useState(E.pageSize||10),N=P[0],h=P[1],L=t.useState(E.sortParams||[{id:"createdTime",desc:!1}]),T=L[0],A=L[1],D=t.useState(0),M=D[0],x=D[1],B=t.useState(function(){return E.searchParams||{}}),w=B[0],k=B[1],F=Digit.Hooks.receipts.useReceiptsSearch(o({},w,{isCountRequest:!0}),C,[],S),U=F.data,H=(s(F,I),window.Digit.Utils.browser.isMobile()),V=H?{limit:100,offset:R,sortOrder:null!=T&&null!==(a=T[0])&&void 0!==a&&a.desc?"DESC":"ASC"}:{limit:N,offset:R,sortOrder:null!=T&&null!==(r=T[0])&&void 0!==r&&r.desc?"DESC":"ASC"},Y=Digit.Hooks.receipts.useReceiptsSearch(w,C,V,S),z=Y.isLoading,G=Y.data,j=s(Y,O);t.useEffect(function(){return function(){null==j||j.revalidate()}},[]),t.useEffect(function(){x(null==U?void 0:U.Count)},[U]),t.useEffect(function(){_(0)},[w]);var q=function(){_(function(e){return e+N})},W=function(){_(function(e){return e-N})},Z=function(e,t){if(void 0===t&&(t=!1),t)k(o({},E.searchParams));else{var n=e.delete,a=o({},w,e);n&&n.forEach(function(e){return delete a[e]}),delete a.delete,k(o({},a))}},K=t.useCallback(function(e){0!==e.length&&A(e)},[]),X=function(e){h(Number(e.target.value))},J=function(){return[{label:g("CR_CONSUMER_NO_LABEL"),name:"consumerCodes"},{label:g("CR_RECEPIT_NO_LABEL"),name:"receiptNumbers"},{label:g("CR_MOBILE_NO_LABEL"),name:"mobileNumber",maxlength:10,pattern:"[6-9][0-9]{9}",title:g("ES_SEARCH_APPLICATION_MOBILE_INVALID"),componentInFront:"+91"}]};if(null!==(null==G?void 0:G.length))return H?n.createElement(y,{businessService:d,data:G,tableConfig:null==j?void 0:j.tableConfig,isLoading:z,defaultSearchParams:E.searchParams,isSearch:!p,onFilterChange:Z,searchFields:J(),onSearch:Z,onSort:K,onNextPage:q,onPrevPage:W,currentPage:Math.floor(R/N),pageSizeLimit:N,disableSort:!1,onPageSizeChange:X,parentRoute:c,searchParams:w,sortParams:T,totalRecords:M,linkPrefix:"/digit-ui/employee/receipts/details/",filterComponent:v}):n.createElement("div",null,p&&n.createElement(l.Header,null,g("CR_SEARCH_COMMON_HEADER")),n.createElement(b,{businessService:d,data:G,isLoading:z,defaultSearchParams:E.searchParams,isSearch:!p,onFilterChange:Z,searchFields:J(),onSearch:Z,onSort:K,onNextPage:q,onPrevPage:W,onLastPage:function(){_(function(e){return(null==U?void 0:U.Count)&&10*Math.ceil((null==U?void 0:U.Count)/10)-N})},onFirstPage:function(){_(function(e){return 0})},currentPage:Math.floor(R/N),pageSizeLimit:N,disableSort:!1,onPageSizeChange:X,parentRoute:c,searchParams:w,sortParams:T,totalRecords:M,filterComponent:v}))},ReceiptAcknowledgement:function(e){var r,o,s=i.useTranslation().t,c=Digit.ULBService.getCurrentTenantId(),u=e.location.state,d=Digit.Hooks.receipts.useReceiptsUpdate(c,null==u?void 0:u.businessService),m=Digit.Hooks.useSessionStorage("EMPLOYEE_RECEIPT_MUTATION_HAPPENED",!1),E=m[0],v=m[1],p=Digit.Hooks.useSessionStorage("EMPLOYEE_RECEIPT_ERROR_DATA",!1),C=p[0],S=p[1],f=Digit.Hooks.useSessionStorage("EMPLOYEE_RECEIPT_MUTATION_SUCCESS_DATA",!1),R=f[0],_=f[1];t.useEffect(function(){d.data&&_(d.data)},[d.data]);var P=function(e,t){var n,a,l;S((null==e||null===(n=e.response)||void 0===n||null===(a=n.data)||void 0===a||null===(l=a.Errors[0])||void 0===l?void 0:l.code)||"ERROR"),v(!0)};if(t.useEffect(function(){"UPDATE"!==u.key||E||C||d.mutate({paymentWorkflows:[u.paymentWorkflow]},{onError:P,onSuccess:function(){v(!0)}})},[]),d.isLoading||d.isIdle&&!E)return n.createElement(l.Loader,null);var N=(null==d||null===(r=d.data)||void 0===r?void 0:r.Payments[0])||(null==R||null===(o=R.Payments)||void 0===o?void 0:o[0]),h=!!R||(null==d?void 0:d.isSuccess);return n.createElement(l.Card,null,n.createElement(g,{t:s,data:(null==d?void 0:d.data)||R,action:u.action,isSuccess:h,isLoading:d.isIdle&&!E||(null==d?void 0:d.isLoading),isEmployee:e.parentRoute.includes("employee")}),n.createElement(l.CardText,null,s(function(e,t,n,a){return t?(Digit.SessionStorage.set("isupdate",Math.floor(1e5+9e5*Math.random())),a("CR_APPLY_FORWARD_SUCCESS")):(null==d||null===(l=d.error)||void 0===l||null===(i=l.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.Errors[0].code)||C;var l,i,r}(0,h,e.parentRoute.includes("employee"),s),s)),h&&n.createElement(l.CardText,null,n.createElement(l.LinkButton,{label:n.createElement("div",{className:"response-download-button"},n.createElement("span",null,n.createElement("svg",{width:"20",height:"18",viewBox:"0 0 20 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},n.createElement("path",{d:"M17 5H3C1.34 5 0 6.34 0 8V14H4V18H16V14H20V8C20 6.34 18.66 5 17 5ZM14 16H6V11H14V16ZM17 9C16.45 9 16 8.55 16 8C16 7.45 16.45 7 17 7C17.55 7 18 7.45 18 8C18 8.55 17.55 9 17 9ZM16 0H4V4H16V0Z",fill:"#a82227"}))),n.createElement("span",{className:"download-button"},s("COMMON_TABLE_PRINT"))),style:{width:"100px"},onClick:function(){var e,t,n;!function(e,t){try{Promise.resolve(Digit.Utils.downloadReceipt(t,e,"consolidatedreceipt")).then(function(){})}catch(e){return Promise.reject(e)}}(null==N||null===(e=N.paymentDetails[0])||void 0===e?void 0:e.businessService,null==N||null===(t=N.paymentDetails[0])||void 0===t||null===(n=t.bill)||void 0===n?void 0:n.consumerCode)}})),n.createElement(l.ActionBar,null,n.createElement(a.Link,{to:e.parentRoute.includes("employee")?"/digit-ui/employee":"/digit-ui/citizen"},n.createElement(l.SubmitBar,{label:s("CORE_COMMON_GO_TO_HOME")}))))},ReceiptDetails:function(){var e,r,o,c,u,v,p,C,S,g,R,_,P,N,h,L=t.useState(!1),b=L[0],T=L[1],A=i.useTranslation().t,y=a.useParams(),I=y.id,O=y.service,D=Digit.ULBService.getCurrentTenantId(),M=Digit.SessionStorage.get("isupdate"),x=Digit.Hooks.receipts.useReceiptsSearch({receiptNumbers:decodeURIComponent(I),businessServices:O},D,{},M),B=x.isLoading,w=x.data,k=s(x,f);t.useEffect(function(){return function(){null==k||k.revalidate()}},[]);var F=Digit.Hooks.useSessionStorage("EMPLOYEE_RECEIPT_MUTATION_HAPPENED",!1)[1],U=Digit.Hooks.useSessionStorage("EMPLOYEE_RECEIPT_MUTATION_SUCCESS_DATA",!1)[2],H=Digit.Hooks.useSessionStorage("EMPLOYEE_RECEIPT_ERROR_DATA",!1)[2];if(t.useEffect(function(){F(!1),U(),H()},[]),B)return n.createElement(l.Loader,null);var V,Y,z,G,j,q,W,Z,K,X=!B&&(null==w||null===(e=w.Payments)||void 0===e?void 0:e.length)>0?w.Payments[0]:{},J=(null==X?void 0:X.totalDue)-(null==X?void 0:X.totalAmountPaid);return n.createElement(n.Fragment,null,n.createElement("div",{style:{width:"30%",fontFamily:"calibri",color:"#FF0000"}},n.createElement(l.Header,null,A("CR_RECEIPT_SUMMARY"))),!B&&(null==w||null===(r=w.Payments)||void 0===r?void 0:r.length)>0?n.createElement("div",null,n.createElement(l.Card,null,n.createElement(l.StatusTable,null,n.createElement(l.Row,{label:A("CR_RECEIPT_NUMBER"),text:(null==X||null===(o=X.paymentDetails[0])||void 0===o?void 0:o.receiptNumber)||"NA",textStyle:{whiteSpace:"pre"}}),n.createElement(l.Row,{label:A("CR_RECEIPT_CONSUMER_NUMBER"),text:(null==X||null===(c=X.paymentDetails[0])||void 0===c||null===(u=c.bill)||void 0===u?void 0:u.consumerCode)||"NA",textStyle:{whiteSpace:"pre"}}),n.createElement(l.Row,{label:A("CR_RECEIPT_PAYMENT_DATE"),text:m(null==X||null===(v=X.paymentDetails[0])||void 0===v?void 0:v.receiptDate)||"NA"}),n.createElement(l.Row,{label:A("CR_RECEIPT_PAYER_NAME"),text:(null==X?void 0:X.payerName)||"NA"}),n.createElement(l.Row,{label:A("CR_RECEIPT_PAYER_NUMBER"),text:(null==X?void 0:X.mobileNumber)||"NA"}),n.createElement(l.Row,{label:A("CR_RECEIPT_SERVICE_TYPE"),text:A(E(null==X||null===(p=X.paymentDetails[0])||void 0===p?void 0:p.businessService,"BILLINGSERVICE_BUSINESSSERVICE"))||"NA"}),n.createElement(l.Row,{label:A("CR_RECEIPT_BILL_PERIOD"),text:(q=null==X||null===(C=X.paymentDetails[0])||void 0===C||null===(S=C.bill)||void 0===S||null===(g=S.billDetails[0])||void 0===g?void 0:g.fromPeriod,W=null==X||null===(R=X.paymentDetails[0])||void 0===R||null===(_=R.bill)||void 0===_||null===(P=_.billDetails[0])||void 0===P?void 0:P.toPeriod,Z=new Date(q),K=new Date(W),(K.getYear()-Z.getYear()!=0?"FY"+(Z.getYear()+1900)+"-"+(K.getYear()-100):Z.toLocaleDateString()+"-"+K.toLocaleDateString())||"NA")}),n.createElement(l.Row,{label:A("CR_RECEIPT_AMOUNT"),text:"₹"+(null==X?void 0:X.totalAmountPaid)||"NA"}),n.createElement(l.Row,{label:A("CR_RECEIPT_PENDING_AMOUNT"),text:"₹"+J||"₹0"}),n.createElement(l.Row,{label:A("CR_RECEIPT_PAYMENT_MODE"),text:null!=X&&X.paymentMode&&A("COMMON_MASTERS_PAYMENTMODE_"+(null==X?void 0:X.paymentMode))||"NA"}),n.createElement(l.Row,{label:A("CR_RECEIPT_TXN_ID"),text:(null==X?void 0:X.transactionNumber)||"NA"}),n.createElement(l.Row,{label:A("CR_RECEIPT_G8_RECEIPT_NO"),text:(null==X||null===(N=X.paymentDetails[0])||void 0===N?void 0:N.manualReceiptNumber)||"NA"}),n.createElement(l.Row,{label:A("CR_RECEIPT_G8_RECEIPT_DATE"),text:m(null==X||null===(h=X.paymentDetails[0])||void 0===h?void 0:h.manualReceiptDate)||"NA"})))):null,b?n.createElement(d,{t:A,tenantId:D,applicationData:w,closeModal:function(){T(!1)},submitAction:function(e){}}):null,n.createElement(l.ActionBar,null,(void 0===(V=X)&&(V={}),"CANCELLED"!==(null===(Y=V)||void 0===Y?void 0:Y.paymentStatus)&&"DEPOSITED"!==(null===(z=V)||void 0===z?void 0:z.paymentStatus)&&("APPROVED"==(null===(G=V)||void 0===G?void 0:G.instrumentStatus)||"REMITTED"==(null===(j=V)||void 0===j?void 0:j.instrumentStatus))&&n.createElement(l.SubmitBar,{label:A("CR_CANCEL_RECEIPT_BUTTON"),onSubmit:function(){T(!0)}}))))},ActionModal:d,Banner:function(e){var t,a=e.t,i=e.config;return n.createElement(l.LabelFieldPair,null,n.createElement(l.CardLabel,{className:"card-label-smaller",style:{color:"white"}},"."),n.createElement("span",{className:"form-field",style:{color:"gray"}},a(null==i||null===(t=i.texts)||void 0===t?void 0:t.header)))},RECEIPTS_INBOX_FILTER:function(e){return n.createElement(C,e)}};exports.ReceiptsModule=M,exports.initReceiptsComponents=function(){Object.entries(x).forEach(function(e){Digit.ComponentRegistryService.setComponent(e[0],e[1])})};
